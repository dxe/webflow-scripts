function getCookie(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),a=0;a<n.length;a++){for(var o=n[a];" "==o.charAt(0);)o=o.substring(1);if(0==o.indexOf(e))return o.substring(e.length,o.length)}return""}function formatAMPM(t){var e=t.getHours(),n=t.getMinutes(),a=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(n=n<10?"0"+n:n)+a}function getAllChapters(){fetch("https://adb.dxe.io/fb_pages").then(t=>t.json()).then(t=>{let e="";for(let[n,a]of Object.entries(t))e+=`<div class="location-title">${n}</div><div class="location-home">`,a.forEach(t=>{e+=`\n\t\t\t\t\t<div class="location-button">\n\t\t\t\t\t    <a href="#" onClick="updateSelectedChapter('${t.Name}','${t.ID}','${t.FbURL}','${t.Flag}')" class="location-link w-inline-block">\n\t\t\t\t\t        <div class="text-block-10">${t.Flag} ${t.Name}</div>\n\t\t\t\t\t    </a>\n\t\t\t\t\t</div>\n\t\t\t\t\t`}),e+="</div>";$("#chapter-regions-wrapper").append(e)}).catch(t=>{console.warn(t)})}function updateSelectedChapter(t,e,n,a){$("#selected-chapter").text(a+" "+t),hideChapterSelector(),""===n&&(n="https://facebook.com/directactioneverywhere"),document.cookie=`chapterName=${encodeURIComponent(t)}`,document.cookie=`chapterID=${encodeURIComponent(e)}`,document.cookie=`fbURL=${encodeURIComponent(n)}`,document.cookie=`chapterFlag=${encodeURIComponent(a)}`,$("a[data-action='view-facebook']").attr("href",n+"/events"),$("a[data-action='view-facebook']").text(`View ${t} on Facebook`),$("#event-items-wrapper").empty();let o=(new Date).addHours(-1).toISOString().substring(0,16);console.log(`Getting events that start at ${o} or later.`);let i=(new Date).addHours(720).toISOString().substring(0,16);fetch(`https://adb.dxe.io/fb_events/${e}?start_time=${o}&end_time=${i}`).then(t=>t.json()).then(a=>{null!==a||0!=e?null!==a?a.forEach(t=>{let e=new Date(t.StartTime).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),n=formatAMPM(new Date(t.StartTime)),a=`https://www.facebook.com/events/${t.ID}`;t.Cover||(t.Cover="https://ec2.dxe.io/img/default_cover.jpg"),$("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-image"><a href="${a}" target="_blank"><img width="1010" src="${t.Cover}" class="fb-event-thumbnail"></a></div>\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">${t.Name}</div>\n\t\t\t                <div class="fb-event-info">${e} at ${n}</div>\n\t\t\t                <div class="fb-event-info">${t.LocationName}</div>\n\t\t\t                <div class="fb-event-info">${t.AttendingCount} attending | ${t.InterestedCount} interested</div>\n\t\t\t                <div class="fb-event-info"><a href="${a}" class="link" target="_blank">RSVP on Facebook</a></div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`)}):$("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">No upcoming events found</div>\n\t\t\t                <div class="fb-event-info">Sorry, there are no upcoming events for ${t}.</div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`):$("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">No events found</div>\n\t\t\t                <div class="fb-event-info">Please check <a href="${n}/events" target="_blank">Facebook</a>.</div>\n\t\t\t                <div class="fb-event-info"><strong>Are you an organizer?</strong> Please email <a href="mailto:tech@dxe.io">tech@dxe.io</a> for your events to be added here.</div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`)}).catch(t=>{console.warn(t)})}function loadFeaturedEvent(){let t=(new Date).addHours(-1).toISOString().substring(0,16);console.log(`Getting events that start at ${t} or later.`);let e=(new Date).addHours(720).toISOString().substring(0,16);fetch(`https://adb.dxe.io/fb_events/287332515138353?start_time=${t}&end_time=${e}`).then(t=>t.json()).then(t=>{if(null===t)return;let e=t[0];let n=new Date(e.StartTime).toLocaleDateString(void 0,{weekday:"long",year:"numeric",month:"long",day:"numeric"}),a=(formatAMPM(new Date(e.StartTime)),`https://www.facebook.com/events/${e.ID}`);e.Cover||(e.Cover="https://ec2.dxe.io/img/default_cover.jpg");let o=`\n\t\t\t<div class="full-container full">\n\t\t\t   <div class="columns w-row">\n\t\t\t      <div class="column-9 w-col w-col-6 w-col-stack"><img src="${e.Cover}" class="image-5"></div>\n\t\t\t      <div class="column-10 w-col w-col-6 w-col-stack">\n\t\t\t         <div class="campaign-div transparent">\n\t\t\t            <div class="tag-line">Featured event</div>\n\t\t\t            <h2 class="header">${e.Name}</h2>\n\t\t\t            <p class="paragraph limit">${n}<br />${e.LocationName}</p>\n\t\t\t            <div class="buttons-div"><a href="${a}" target="_blank" class="button transparent _25 w-button">Learn more</a></div>\n\t\t\t         </div>\n\t\t\t      </div>\n\t\t\t   </div>\n\t\t\t</div>\n\t\t`;$("div.hero-section").append(o)}).catch(t=>{console.warn(t)})}function geolocate(){window.navigator&&window.navigator.geolocation&&navigator.geolocation.getCurrentPosition(onGeolocateSuccess,onGeolocateError)}function onGeolocateSuccess(t){const{latitude:e,longitude:n}=t.coords;loadNearestEvents(e,n)}function loadNearestEvents(t=0,e=0){fetch(`https://adb.dxe.io/fb_page/${t},${e}`).then(t=>t.json()).then(t=>{t[0].Distance>100&&document.getElementById("event-items-wrapper").insertAdjacentHTML("beforeBegin",`<div style="padding-bottom: 30px;"><h3>The closest chapter to you is ${Math.round(t[0].Distance)} miles away.</h3><p>Contact <a href="mailto:mentoring@dxe.io">mentoring@dxe.io</a> to start a chapter of your own!</p></div>`),updateSelectedChapter(t[0].Name,t[0].ID,t[0].FbURL,t[0].Flag),$("a[data-action='find-chapter']").html('<i class="fas fa-map-marker-alt"></i>&nbsp;&nbsp;Find my chapter')}).catch(t=>{console.warn(t)})}function onGeolocateError(t){console.warn(t.code,t.message),1===t.code?$("a[data-action='find-chapter']").text("You denied location sharing."):2===t.code?$("a[data-action='find-chapter']").text("Failed."):3===t.code&&$("a[data-action='find-chapter']").text("Timeout.")}function showChapterSelector(){$(".select-location-custom").css("display","flex"),$(".select-location-custom").fadeTo(200,.99)}function hideChapterSelector(){$(".select-location-custom").fadeTo(200,0,function(){$(".select-location-custom").css("display","none")})}Date.prototype.addHours=function(t){return this.setTime(this.getTime()+60*t*60*1e3),this},$(document).ready(function(){$("a[data-action='find-chapter']").html('<i class="fas fa-map-marker-alt"></i>&nbsp;&nbsp;Find my chapter');var t=getCookie("chapterName"),e=getCookie("chapterID"),n=getCookie("fbURL"),a=getCookie("chapterFlag");loadFeaturedEvent(),t&&e&&n&&a?updateSelectedChapter(t,e,n,a):loadNearestEvents(),getAllChapters()}),$("a[data-action='find-chapter']").click(function(){$("a[data-action='find-chapter']").text("Locating..."),geolocate()});