function getCookie(t){for(var e=t+"=",n=decodeURIComponent(document.cookie).split(";"),o=0;o<n.length;o++){for(var a=n[o];" "==a.charAt(0);)a=a.substring(1);if(0==a.indexOf(e))return a.substring(e.length,a.length)}return""}function formatAMPM(t){var e=t.getHours(),n=t.getMinutes(),o=e>=12?"pm":"am";return(e=(e%=12)||12)+":"+(n=n<10?"0"+n:n)+o}function getAllChapters(){fetch("https://adb.dxe.io/fb_pages").then(t=>t.json()).then(t=>{let e="";for(let[n,o]of Object.entries(t))e+=`<div class="location-title">${n}</div><div class="location-home">`,o.forEach(t=>{e+=`\n\t\t\t\t\t<div class="location-button">\n\t\t\t\t\t    <a href="#" onClick="updateSelectedChapter('${t.Name}','${t.ID}','${t.FbURL}','${t.Flag}')" class="location-link w-inline-block">\n\t\t\t\t\t        <div class="text-block-10">${t.Flag} ${t.Name}</div>\n\t\t\t\t\t    </a>\n\t\t\t\t\t</div>\n\t\t\t\t\t`}),e+="</div>";$("#chapter-regions-wrapper").append(e)}).catch(t=>{console.warn(t)})}function updateSelectedChapter(t,e,n,o){$("#selected-chapter").text(o+" "+t),hideChapterSelector(),""===n&&(n="https://facebook.com/directactioneverywhere"),document.cookie=`chapterName=${encodeURIComponent(t)}`,document.cookie=`chapterID=${encodeURIComponent(e)}`,document.cookie=`fbURL=${encodeURIComponent(n)}`,document.cookie=`chapterFlag=${encodeURIComponent(o)}`,$("a[data-action='view-facebook']").attr("href",n+"/events"),$("a[data-action='view-facebook']").text(`View ${t} on Facebook`),$("#event-items-wrapper").empty();let a=(new Date).addHours(-1).toISOString().substring(0,16),i=(new Date).addHours(720).toISOString().substring(0,16);fetch(`https://adb.dxe.io/fb_events/${e}?start_time=${a}&end_time=${i}`).then(t=>t.json()).then(o=>{if(null!==o||0!=e)if(null!==o)for(let t=0;t<3;t++){console.log(t);let e=o[t];const n={weekday:"long",year:"numeric",month:"long",day:"numeric"};let a=new Date(e.StartTime).toLocaleDateString(void 0,n),i=formatAMPM(new Date(e.StartTime)),c=`https://www.facebook.com/events/${e.ID}`;e.Cover||(e.Cover="https://ec2.dxe.io/img/default_cover.jpg"),$("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-image"><a href="${c}" target="_blank"><img width="1010" src="${e.Cover}" class="fb-event-thumbnail"></a></div>\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">${e.Name}</div>\n\t\t\t                <div class="fb-event-info">${a} at ${i}</div>\n\t\t\t                <div class="fb-event-info">${e.LocationName}</div>\n\t\t\t                <div class="fb-event-info">${e.AttendingCount} attending | ${e.InterestedCount} interested</div>\n\t\t\t                <div class="fb-event-info"><a href="${c}" class="link" target="_blank">RSVP on Facebook</a></div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`)}else $("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">No upcoming events found</div>\n\t\t\t                <div class="fb-event-info">Sorry, there are no upcoming events for ${t}.</div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`);else $("#event-items-wrapper").append(`\n\t\t\t\t<div class="w-dyn-item">\n\t\t\t        <div class="event-div">\n\t\t\t            <div class="event-info-div">\n\t\t\t                <div class="event-title">No events found</div>\n\t\t\t                <div class="fb-event-info">Please check <a href="${n}/events" target="_blank">Facebook</a>.</div>\n\t\t\t                <div class="fb-event-info"><strong>Are you an organizer?</strong> Please email <a href="mailto:tech@dxe.io">tech@dxe.io</a> for your events to be added here.</div>\n\t\t\t            </div>\n\t\t\t        </div>\n\t\t\t    </div>\n\t\t\t\t`)}).catch(t=>{console.warn(t)})}function geolocate(){window.navigator&&window.navigator.geolocation&&navigator.geolocation.getCurrentPosition(onGeolocateSuccess,onGeolocateError)}function onGeolocateSuccess(t){const{latitude:e,longitude:n}=t.coords;loadNearestEvents(e,n)}function loadNearestEvents(t=0,e=0){fetch(`https://adb.dxe.io/fb_page/${t},${e}`).then(t=>t.json()).then(t=>{t[0].Distance>100&&document.getElementById("event-items-wrapper").insertAdjacentHTML("beforeBegin",`<div style="padding-bottom: 30px;"><h3>The closest chapter to you is ${Math.round(t[0].Distance)} miles away.</h3><p>Contact <a href="mailto:mentoring@dxe.io">mentoring@dxe.io</a> to start a chapter of your own!</p></div>`),updateSelectedChapter(t[0].Name,t[0].ID,t[0].FbURL,t[0].Flag),$("a[data-action='find-chapter']").html('<i class="fas fa-map-marker-alt"></i>&nbsp;&nbsp;Find my chapter')}).catch(t=>{console.warn(t)})}function onGeolocateError(t){console.warn(t.code,t.message),1===t.code?$("a[data-action='find-chapter']").text("You denied location sharing."):2===t.code?$("a[data-action='find-chapter']").text("Failed."):3===t.code&&$("a[data-action='find-chapter']").text("Timeout.")}function showChapterSelector(){$(".select-location-custom").css("display","flex"),$(".select-location-custom").fadeTo(200,.99)}function hideChapterSelector(){$(".select-location-custom").fadeTo(200,0,function(){$(".select-location-custom").css("display","none")})}Date.prototype.addHours=function(t){return this.setTime(this.getTime()+60*t*60*1e3),this},$(document).ready(function(){$("a[data-action='find-chapter']").html('<i class="fas fa-map-marker-alt"></i>&nbsp;&nbsp;Find my chapter');var t=getCookie("chapterName"),e=getCookie("chapterID"),n=getCookie("fbURL"),o=getCookie("chapterFlag");t&&e&&n&&o?updateSelectedChapter(t,e,n,o):loadNearestEvents(),getAllChapters()}),$("a[data-action='find-chapter']").click(function(){$("a[data-action='find-chapter']").text("Locating..."),geolocate()});